# 평가 열람 권한 기능 - 케이스별 시나리오

## 📌 기능 개요

**두 가지 권한 설정의 교차 적용**

| 설정 | 적용 범위 | 설정값 |
|------|----------|--------|
| **현재 단계 열람 권한** | 내가 할당받은 평가 | unrestricted / after_feedback / restricted |
| **전체 단계 열람 권한** | 과거 평가자의 전체 열람 | ON / OFF |

> [!IMPORTANT]
> **설정 간 의존성 규칙**
> - `restricted` 선택 시 → 전체 단계 열람 옵션이 **비활성화**됨
> - 이유: 현재 단계 타인 평가를 제한하면서 이후 단계를 열람할 수 있는 것은 논리적으로 모순
> - UI에서 명확히 표시: "제한 설정과 함께 사용할 수 없습니다"

---

## 🎭 등장인물

| 역할 | 설명 |
|------|------|
| **김서류** | 서류 평가 담당자 |
| **박일차** | 1차 면접관 |
| **이이차** | 2차 면접관 |
| **최관리** | 채용 관리자 (job_admin) |

---

## 📋 시나리오 목록

### 시나리오 1: 기본 케이스 - 1차 면접관의 평가 열람

**설정**
- 현재 단계 열람: `after_feedback`
- 전체 단계 열람: `ON`

**상황**
> 지원자 A가 서류 → 1차 면접 → 2차 면접 순으로 진행 중
> 박일차는 1차 면접관으로 배정됨

#### Case 1-1: 1차 평가 완료 전

```
[박일차가 지원자 A 상세 페이지 진입]

현재 상태:
- 서류 평가: ✅ 완료 (김서류 평가)
- 1차 면접: 🔄 진행중 (박일차 평가 미완료)
- 2차 면접: ⏳ 예정

박일차가 볼 수 있는 것:
✅ 서류 평가 내용 → 열람 가능 (이전 단계는 항상 열람 가능)
❌ 1차 면접 평가 내용 → 열람 불가 (본인 미완료, 현재 단계)
❌ 2차 면접 → 아직 없음

💡 이유: after_feedback은 '현재 단계'에만 적용, 이전 단계는 무조건 열람 가능
```

#### Case 1-2: 1차 평가 완료 후

```
[박일차가 1차 평가 제출 완료]
[박일차가 지원자 A 상세 페이지 재진입]

현재 상태:
- 서류 평가: ✅ 완료
- 1차 면접: ✅ 완료 (박일차 평가 완료)
- 2차 면접: 🔄 진행중 (이이차 평가중)

박일차가 볼 수 있는 것:
✅ 서류 평가 내용 → 열람 가능
✅ 1차 면접 본인 평가 → 열람 가능
✅ 1차 면접 다른 평가자 평가 → 열람 가능
✅ 2차 면접 평가 내용 → 열람 가능 (전체 단계 열람 ON)

💡 이유: 본인 평가 완료 + 전체 단계 열람 ON = 모든 평가 열람
```

---

### 시나리오 2: 전체 단계 열람 OFF인 경우

**설정**
- 현재 단계 열람: `after_feedback`
- 전체 단계 열람: `OFF`

**상황**
> 동일하게 박일차가 1차 평가 완료 후 조회

#### Case 2-1: 1차 평가 완료 후 (전체 열람 OFF)

```
[박일차가 1차 평가 제출 완료]
[박일차가 지원자 A 상세 페이지 진입]

박일차가 볼 수 있는 것:
✅ 서류 평가 내용 → 열람 가능 (이전 단계)
✅ 1차 면접 평가 내용 → 열람 가능 (본인 단계)
❌ 2차 면접 평가 내용 → 열람 불가

💡 이유: 전체 단계 열람 OFF → 현재(1차) 단계까지만 열람
```

---

### 시나리오 3: unrestricted 설정인 경우

**설정**
- 현재 단계 열람: `unrestricted`
- 전체 단계 열람: `ON`

**상황**
> 박일차가 1차 평가 미완료 상태로 조회

#### Case 3-1: 1차 평가 미완료 (unrestricted)

```
[박일차가 지원자 A 상세 페이지 진입]
[박일차는 아직 1차 평가를 제출하지 않음]

박일차가 볼 수 있는 것:
✅ 서류 평가 내용 → 열람 가능
✅ 1차 면접 다른 평가자 평가 → 열람 가능 (unrestricted)
✅ 2차 면접 평가 내용 → 열람 가능 (전체 단계 열람 ON)

💡 이유: unrestricted는 완료 여부 상관없이 즉시 열람 가능
```

---

### 시나리오 4: restricted 설정인 경우

**설정**
- 현재 단계 열람: `restricted`
- 전체 단계 열람: `비활성화` (restricted 선택 시 자동)

**상황**
> 박일차가 1차 평가 완료 후 조회

#### Case 4-1: 1차 평가 완료 (restricted)

```
[박일차가 1차 평가 제출 완료]
[박일차가 지원자 A 상세 페이지 진입]

박일차가 볼 수 있는 것:
✅ 서류 평가 내용 → 열람 가능 (이전 단계)
❌ 1차 면접 다른 평가자 평가 → 열람 불가 (restricted)
✅ 본인 1차 평가만 → 열람 가능
❌ 2차 면접 평가 내용 → 열람 불가 (전체 단계 열람 비활성화)

💡 이유: restricted 선택 시 전체 단계 열람 옵션이 비활성화됨
        → 현재 단계 제한과 이후 단계 열람 허용의 모순 방지
```

---

### 시나리오 5: 서류 평가자가 이후 단계 조회

**설정**
- 현재 단계 열람: `after_feedback`
- 전체 단계 열람: `ON`

**상황**
> 김서류가 서류 평가 완료 후, 지원자가 2차 면접 중일 때 조회

#### Case 5-1: 서류 평가자의 전체 열람

```
[지원자 A는 현재 2차 면접 진행 중]
[김서류는 서류 단계에서만 평가 권한이 있었음]
[김서류가 지원자 A 상세 페이지 진입]

김서류가 볼 수 있는 것:
✅ 서류 평가 내용 → 열람 가능 (본인 완료)
✅ 1차 면접 평가 내용 → 열람 가능 (전체 단계 열람)
✅ 2차 면접 평가 내용 → 열람 가능 (전체 단계 열람)

💡 이유: 과거에 평가를 완료했으므로 전체 단계 열람 권한 적용
```

---

### 시나리오 6: 평가 권한이 없는 사용자

**설정**
- 현재 단계 열람: `after_feedback`
- 전체 단계 열람: `ON`

**상황**
> 신입사원이 지원자 상세 페이지를 조회
> 이 사람은 어떤 평가에도 참여한 적이 없음

#### Case 6-1: 평가 이력 없는 사용자

```
[신입사원이 지원자 A 상세 페이지 진입]
[신입사원은 어떤 평가에도 배정된 적 없음]

신입사원이 볼 수 있는 것:
❌ 모든 평가 → 열람 불가

💡 이유: 
- 할당된 평가 없음 → 현재 단계 권한 적용 안됨
- 완료한 평가 없음 → 전체 단계 열람 조건 미충족
```

---

## 📊 전체 케이스 요약표

| # | 역할 | 현재 단계 설정 | 전체 단계 | 평가 상태 | 서류 | 1차 | 2차 |
|---|------|--------------|----------|----------|------|-----|-----|
| 1-1 | 1차 면접관 | after_feedback | ON | 미완료 | ✅ | ❌ | ❌ |
| 1-2 | 1차 면접관 | after_feedback | ON | 완료 | ✅ | ✅ | ✅ |
| 2-1 | 1차 면접관 | after_feedback | OFF | 완료 | ✅ | ✅ | ❌ |
| 3-1 | 1차 면접관 | unrestricted | ON | 미완료 | ✅ | ✅ | ✅ |
| 4-1 | 1차 면접관 | restricted | (비활성화) | 완료 | ✅ | △* | ❌ |
| 5-1 | 서류 평가자 | after_feedback | ON | 완료 | ✅ | ✅ | ✅ |
| 6-1 | 미배정 | after_feedback | ON | 없음 | ❌ | ❌ | ❌ |

*△: 본인 평가만 열람 가능, 타인 평가 불가
*(비활성화): restricted 선택 시 전체 단계 열람 옵션 사용 불가

---

## 🔑 핵심 원칙 정리

1. **현재 단계 권한이 먼저 적용** → 내 평가 완료 여부 체크
2. **restricted 선택 시 전체 단계 열람 비활성화** → 설정 간 의존성
3. **완료 후 전체 단계 권한 확인** → ON이면 모든 단계 열람 (restricted 제외)
4. **평가 이력이 없으면 제한** → 어떤 평가도 안 했으면 볼 수 없음
5. **Admin은 예외** → 항상 전체 열람 가능
